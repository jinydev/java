# 12. 장면 이동과 애니메이션

애플리케이션은 다양한 화면을 가지고 있다. 메인 화면에서 시작해 사용자의 선택에 따라 가입 화

면, 로그인 화면, 목록 화면 등으로 이동된다. 화면이 이동될 때 애니메이션을 적용하면 눈을 즐겁게

만들어준다. 같은 화면에서도 마우스의 위치에 따라 컨트롤의 속성을 변화시켜 다이나믹한 애니메

이션을 만들 수도 있다.

이번 절에서는 화면을 이동시키는 방법과 슬라이드slide와 페이드fade 애니메이션을 적용하는 방법을

알아보기로 하자.

화면 이동

JavaFX에서 화면은 장면이므로 화면을 이동한다는 것은 즉 장면을 변경하는 것이다. 장면을 변경

하는 가장 쉬운 방법은 Stage에 새로운 Scene을 세팅하는 것이다.

메인 화면에서 로그인 화면으로 이동하기 위해 버튼을 클릭했다고 가정해보자. 컨트롤러의 이벤트

처리 메소드는 로그인 Scene을 생성하고, primaryStage의 setScene ( ) 메소드로 현재 Scene을

로그인 Scene으로 변경할 수 있다.

```java
public void handlebtnLogin(ActionEvent event) {
try {
Parent login  =  FXMLLoader.load(getClass().getResource("login.fxml"));
Scene scene  =  new Scene(login);
Stage primaryStage  =  (Stage) btnLogin.getScene().getWindow();
primaryStage.setScene(scene);    //화면 변경
} catch(Exception e) {
e.printStackTrace();

}

}


```

setScene ( ) 메소드로 화면을 이동하면 이전 Scene은 Stage에서 제거되므로 애니메이션을 적용할

수 없다. 화면 이동 애니메이션을 적용하려면 이전 화면과 다음 화면이 일시적으로 공존해야 한다.

따라서 화면 이동을 위한 다른 방법이 필요한데, StackPane을 이용하면 화면 이동 효과와 함께 애

니메이션을 적용할 수 있다. 다음과 같이 Scene은 하나만 생성하고 StackPane을 루트 컨테이너로

해서 메인 화면과 로그인 화면을 추가하는 것이다.

StackPane

로그인 장면

메인 장면

인덱스 1

인덱스 0

메인 화면만 StackPane에 추가되어 있는 상태에서 로그인 화면이 생성되고 StackPane에 추가되

면 StackPane은 나중에 추가된 로그인 화면만 사용자에게 보여주고 메인 화면은 뒤로 숨긴다. 반

대로 StackPane에서 로그인 화면을 제거하면 밑에 있는 메인 화면이 보여진다.

이와 같은 방법으로 화면을 이동하게 되면 이전 화면과 다음 화면이 일시적으로 공존하게 되고 애니

메이션을 적용할 수 있게 된다. 다음 예제는 StackPane을 이용해서 로그인 화면과 메인 화면을 번

갈아가면서 보여준다.

>>> root.fxml


```java
<?xml version ="1.0" encoding ="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.*?>

<StackPane xmlns:fx ="http://javafx.com/fxml"
prefHeight ="500" prefWidth ="350"
fx:controller ="sec12.exam01_stackpane.RootController">
<children>
<BorderPane>
<top>
<BorderPane style ="-fx-background-color: #eaeaea;">




<center>
<Label alignment ="CENTER" prefWidth ="215" text ="메인 화면" />
</center>

<right>
<Button fx:id ="btnLogin" text ="로그인"/>
</right>
<padding>
<Insets bottom ="10.0" left ="10.0" right ="10.0" top ="10.0" />
</padding>
</BorderPane>
</top>

<center>
<VBox style ="-fx-background-color: #0000ff;">
</VBox>
</center>
</BorderPane>
</children>
</StackPane>





>>> RootController.java


package sec12.exam01_stackpane;

import java.net.URL;
import java.util.ResourceBundle;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Parent;
import javafx.scene.control.Button;
import javafx.scene.layout.StackPane;

public class RootController implements Initializable {
@FXML private Button btnLogin;

@Override
public void initialize(URL location, ResourceBundle resources) {
btnLogin.setOnAction(e->handleBtnLogin(e));

}

public void  handleBtnLogin(ActionEvent event) {
try {
Parent login =  FXMLLoader.load(getClass().getResource("login.fxml"));
StackPane root  =  (StackPane) btnLogin.getScene().getRoot();
root.getChildren().add(login);
} catch(Exception e) {
e.printStackTrace();
```

로그인 화면으로 이동

}

}

}

>>> login.xml


```java
<?xml version ="1.0" encoding ="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>






<?import javafx.geometry.*?>

<BorderPane  xmlns:fx ="http://javafx.com/fxml"
fx:id ="login" prefHeight ="500" prefWidth ="350"
fx:controller ="sec12.exam01_stackpane.LoginController">
<top>
<BorderPane style ="-fx-background-color: #eaeaea;">
<left>
<Button fx:id ="btnMain" text ="메인"/>
</left>
<center>
<Label alignment ="CENTER" prefWidth ="215" text ="로그인 화면" />
</center>
<padding>
<Insets bottom ="10.0" left ="10.0" right ="10.0" top ="10.0" />
</padding>
</BorderPane>
</top>

<center>
<VBox style ="-fx-background-color: #ffff00;">
</VBox>
</center>
</BorderPane>




>>> LoginController.java


package sec12.exam01_stackpane;

import java.net.URL;
import java.util.ResourceBundle;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.StackPane;

public class LoginController implements Initializable {
@FXML private BorderPane login;
@FXML private Button btnMain;

@Override
public void initialize(URL location, ResourceBundle resources) {
btnMain.setOnAction(e -> handleBtnMain(e));

}

public void handleBtnMain(ActionEvent event) {
try {
StackPane root  =  (StackPane) btnMain.getScene().getRoot();
root.getChildren().remove(login);
} catch (Exception e) {
e.printStackTrace();
```

StackPane에서 로그인 화면
제거, 메인 화면으로 이동

}

}

}

>>> AppMain.java


```java
package sec12.exam01_stackpane;

import javafx.application.Application;
import javafx.fxml.FXMLLoader;
import javafx.scene.Parent;




import javafx.scene.Scene;
import javafx.stage.Stage;

public class AppMain extends Application {
@Override
public void start(Stage primaryStage) throws Exception {
primaryStage.setTitle("AppMain");
Parent root =  FXMLLoader.load(getClass().getResource("root.fxml"));
Scene scene  =  new Scene(root);
primaryStage.setScene(scene);
primaryStage.setWidth(350);
primaryStage.setHeight(500);
primaryStage.setResizable(false);
primaryStage.show();
```

//윈도우의 고정 폭 설정
//윈도우의 고정 높이 설정
//윈도우 크기를 조정할 수 없도록 함

}

public static void main(String[] args) {
launch(args);

}

}

애니메이션

JavaFX에서 애니메이션은 컨트롤 또는 컨테이너의 속성Property 변화를 주어진 시간 동안 진행함으

로써 구현한다. 다음은 애니메이션과 관련된 클래스를 설명한 표이다.

클래스

KeyValue

KeyFrame

Timeline

설명

값이 변경될 타겟 Property와 종료값을 설정하는 객체

애니메이션의 지속 시간과 KeyValue를 설정하는 객체
(지속시간 동안 타겟 Property의 값을 종료값까지 변화시킴)

KeyFrame에 설정된 내용대로 애니메이션을 플레이하는 객체

다음은 컨테이너의 translateX 속성을 주어진 종료값까지 변화시켜 수평 방향으로 슬라이드하는 애

니메이션을 구현한 코드이다. 종료값은 x 좌표값으로 음수, 0, 양수 값을 모두 가질 수 있다.




(cid:733) Timeline timeline  =  new Timeline();
(cid:734) KeyValue keyValue  =  new KeyValue(컨테이너.translateXProperty(), 종료값);
(cid:735) KeyFrame keyFrame  =  new KeyFrame(Duration.millis(지속시간), keyValue);
(cid:736) timeline.getKeyFrames().add(keyFrame);
(cid:737) timeline.play();    //(cid:2455)니메이션 시작

다음 코드는 이전 예제의 [로그인] 버튼 이벤트 처리 메소드를 수정한 것으로, 로그인 화면이 나올 때

우측에서 좌측으로 수평 애니메이션이 진행되도록 했다.

>>> RootController.java


```java
package sec12.exam02_move_animation;

import java.net.URL;
import java.util.ResourceBundle;
import javafx.animation.KeyFrame;
import javafx.animation.KeyValue;
import javafx.animation.Timeline;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Parent;
import javafx.scene.control.Button;
import javafx.scene.layout.StackPane;
import javafx.util.Duration;

public class RootController implements Initializable {
@FXML private Button btnLogin;

@Override
public void initialize(URL location, ResourceBundle resources) {
btnLogin.setOnAction(e->handleBtnLogin(e));

}

public void  handleBtnLogin(ActionEvent event) {
try {
Parent login =  FXMLLoader.load(getClass().getResource("login.fxml"));





StackPane root  =  (StackPane) btnLogin.getScene().getRoot();
root.getChildren().add(login);
```

//로그인 화면의 x 좌표를 350(윈도우 폭) 만(cid:3072) 이동(안보이게 하기 위해서)
login.setTranslateX(350);

//Timeline 객체 생성
Timeline timeline  =  new Timeline();
//로그인 화면의 x 좌표 종료값으로 0을 설정
KeyValue keyValue  =  new KeyValue(login.translateXProperty(), 0);
//0.1초간 종료값까지 x 좌표를 변화시키도록(0 <-- 350) KeyFrame 생성
KeyFrame keyFrame  =  new KeyFrame(Duration.millis(100), keyValue);
//Timeline에 KeyFrame 추가
timeline.getKeyFrames().add(keyFrame);
//(cid:2455)니메이션 시작
timeline.play();
} catch(Exception e) {
e.printStackTrace();

}

}

}




KeyFrame은 지속시간 동안 속성을 종료값까지 변화시키고 나서 콜백 메소드를 자동 호출하는 기

능이 있다. KeyFrame을 생성할 때 두 번째 매개값으로 EventHandler<ActionEvent> 객체를

제공해주면 애니메이션이 종료될 때 handle ( ) 메소드가 자동 실행된다.

KeyFrame keyFrame  =  new KeyFrame(
Duration.millis(지속시간),
new EventHandler<ActionEvent>() {
```java
@Override
public void handle(ActionEvent event) {
//(cid:2455)니메이션이 종료된 후 실행할 코드

}

},
keyValue

);
```

애니메이션이 종료되면 발생되는

이벤트를 처리하는 핸들러 지정

다음 코드는 이전 예제에서 로그인 화면의 [메인] 버튼 이벤트 처리 메소드를 수정한 것으로, 로그인

화면이 사라질 때 좌측에서 우측으로 수평 애니메이션이 진행되도록 했다. 그리고 애니메이션을 종

료한 후에는 StackPane에서 로그인 화면을 완전히 제거한다.

>>> LoginController.java

```java
package sec12.exam02_move_animation;

import java.net.URL;
import java.util.ResourceBundle;
import javafx.animation.KeyFrame;
import javafx.animation.KeyValue;
import javafx.animation.Timeline;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.layout.BorderPane;
import javafx.scene.layout.StackPane;
import javafx.util.Duration;




public class LoginController implements Initializable {
@FXML private BorderPane login;
@FXML private Button btnMain;

@Override
public void initialize(URL location, ResourceBundle resources) {
btnMain.setOnAction(e -> handleBtnMain(e));

}

public void handleBtnMain(ActionEvent event) {
try {
StackPane root  =  (StackPane) btnMain.getScene().getRoot();
```

//로그인 화면의 x 좌표를 0으로 이동시켜놓음(원래 0(cid:2640))
login.setTranslateX(0);

//Timeline 객체 생성
Timeline timeline  =  new Timeline();
//로그인 화면의 x 좌표 종료값으로 350을 설정
KeyValue keyValue  =  new KeyValue(login.translateXProperty(), 350);
//0.1초간 종료값까지 x 좌표를 변화시키도록(0 --> 350) KeyFrame 생성
KeyFrame keyFrame  =  new KeyFrame(
Duration.millis(100),
new EventHandler<ActionEvent>() {
```java
@Override
public void handle(ActionEvent event) {
//(cid:2455)니메이션이 종료된 후, StackPane에서 로그인 화면 제거
root.getChildren().remove(login);

}
},
keyValue

);
//Timeline에 KeyFrame 추가
timeline.getKeyFrames().add(keyFrame);
//(cid:2455)니메이션 시작
timeline.play();
} catch (Exception e) {
e.printStackTrace();

}

}

}


```

